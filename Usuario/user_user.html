<<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplicacion de AGRO HELPING</title>
    

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" 
        integrity="sha512-aOG0c6nPNzGk+5zjwyJaoRUgCdOrfSDhmMID2u4+OIslr0GjpLKo7Xm0Ao3xmpM4T8AmIouRkqwj1nrdVsLKEQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="Usuario/user_user.html">::.. APP AGRO HELPING..::</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mnxAppAcademica"
                    aria-controls="mnxAppAcademica" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="mnxAppAcademica">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" data-modulo="usuario" data-formulario="usuario" href="index.html">Inicio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-modulo="docente" data-formulario="docente" href="#"></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-modulo="materia" data-formulario="materia" href="#"></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-modulo="nota" data-formulario="nota" href="#"></a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="row">
            <div class="col col-md-6 alert-dismissible fade show position-absolute" id="index"></div>
            <div class="col col-md-6 alert-dismissible fade show position-absolute" id="alumno_buscar"></div>
            <div class="col col-md-6 alert-dismissible fade show position-absolute" id="docente_docente"></div>
            <div class="col col-md-6 alert-dismissible fade show position-absolute" id="docente_buscar"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" 
        integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    </script>
    <script src="main.js"></script>
    <html lang="en">
        </head>

    <div id="card_usuario" class="card text-white bg-dark mb-3">
    <div class="card-header">
        REGISTRO USUARIOS 
    
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" data-bs-target="#card_alumno" aria-label="Close"></button>
    </div>
    <div class="card-body">
        <form id="frmUsuarios" data-accion="nuevo" data-idusuarios="0">
            <div class="mb-2 row">
                <input autocomplete="off" id="txtCodigoUsuarios" required pattern="^([CENT|ORIEN|OCCI]){4}[0-9]{6}" placeholder="Codigo" type="text" aria-label="Codigo" class="form-control">
            </div>
            <div class="mb-2 row">
                <input id="txtNombreUsuarios" required pattern="[A-Za-zÑñáéíóú ]{6,65}" placeholder="Nombre" type="text" aria-label="Nombre" class="form-control">
            </div>
            <div class="mb-2 row">
                <input id="txtTelefonoUsuarios" required pattern="[0-9]{4}([-| ]){1}[0-9]{4}" placeholder="Telefono" type="text" aria-label="Tels" class="form-control">
            </div>
            <div class="mb-2 row">
                <button type="submit" class="btn btn-outline-primary text-white">REGISTRAR</button>
                <button type="reset" class="btn btn-outline-warning text-white">NUEVO</button>
                <button type="button" class="btn btn-outline-success text-white" id="btnBuscarUsuarios">BUSCAR</button>
            </div>
            <div id="alerta" class="alert alert-success d-none" role="alert">Hola</div>
        </form>
    </div>
</div>
<script>
    function mostrarDatosUsuarios(usuarios){
        $("#frmUsuarios")
            .data("accion", "modificar")
            .data("idusuario",usuarios.idUsuario);
        $("#txtCodigousuario").val(usuarios.codigo);
        $("#txtNombreUsuario").val(usuarios.nombre);
        $("#txtTelefonoUsuario").val(usuarios.telefono);
    }
    function limpiarFormulario(){
        $("#frmUsuarios")
            .data("accion", "nuevo")
            .data("idusuario",0);
        $("#frmUsuarios input[type=text]").val('');
    }
    function eliminarUsuarios(usuarios){
        if(confirm(`Esta seguro de eliminar el alumno ${usuarios.nombre}?`)){
            let datos = {
                accion : "eliminar",
                idUsuario: usuarios.idUsuario
            };
            $.post("http://localhost:3306/usuarios", JSON.stringify(datos), (data, status)=>{
                limpiarFormulario();
                mostrarMsg(data.resp);
                obtenerDatosUsuarios();
            }, "json");
        }
    }
    function mostrarMsg(msg){
        $("#alerta")
            .text(msg)
            .toggleClass("d-none");
        
        setTimeout(()=>{
            $("#alerta").toggleClass("d-none");
        }, 5000);
    }
    $(document).ready(e=>{
        $("#btnBuscarUsuario").click(e=>{
            e.preventDefault();
            $.abrirVentana("usuarios","buscar");
        });
        $("#frmUsuarios")
            .on("reset", e=>{
                limpiarFormulario();
            })
            .submit(e=>{
            e.preventDefault();

            let accion = $("#frmUsuarios").data("accion"),
                idUsuario = $("#frmUsuarios").data("idusuarios"),
                codigo = $("#txtCodigoUsuarios").val(),
                nombre = $("#txtNombreUsuarios").val(),
                telefono = $("#txtTelefonoUsuarios").val(),
                datos = {accion, idUsuario, codigo, nombre, telefono};

            $.post("http://localhost:3306/usuario", JSON.stringify(datos), (data, status)=>{
                if(data.resp.indexOf("Error")==-1){
                    limpiarFormulario();
                    obtenerDatosAlumno();

                    $("#alerta")
                        .removeClass("alert-danger")
                        .addClass("alert-success");
                }else{
                    $("#alerta")
                        .removeClass("alert-success")
                        .addClass("alert-danger");
                }
                mostrarMsg(data.resp);
            }, "json");
        });
    });
</script>